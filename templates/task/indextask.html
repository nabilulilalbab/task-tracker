<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{.Title}} - Productivity & Learning Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .card-hover:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      .modal-backdrop {
        backdrop-filter: blur(8px);
        background: rgba(0, 0, 0, 0.6);
      }
      .status-todo {
        border-top-color: #9ca3af;
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      }
      .status-inprogress {
        border-top-color: #f59e0b;
        background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      }
      .status-done {
        border-top-color: #10b981;
        background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      }
      .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="bg-gray-50 font-sans antialiased">
    <div class="min-h-screen">
      <div class="container mx-auto p-4 md:p-6 max-w-7xl">
        <!-- Header -->
        <header
          class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8"
        >
          <div class="flex items-center gap-4">
            <div
              class="p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-8 w-8 text-white"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                />
              </svg>
            </div>
            <div>
              <h1 class="text-3xl md:text-4xl font-bold text-gray-800">
                Task Dashboard
              </h1>
              <p class="text-base text-gray-500 mt-1">
                Kelola aktivitas coding dan belajar kamu dengan efisien
              </p>
            </div>
          </div>
          <button
            id="addTaskBtn"
            class="flex items-center gap-2 rounded-xl bg-gradient-to-r from-indigo-500 to-indigo-600 px-6 py-3 text-sm font-semibold text-white shadow-lg hover:from-indigo-600 hover:to-indigo-700 transition-all duration-200"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                clip-rule="evenodd"
              />
            </svg>
            Add Task
          </button>
        </header>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4 mb-8">
          <!-- Total Tasks -->
          <div
            class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-500">Total Tasks</p>
                <p class="mt-2 text-3xl font-bold text-indigo-600">
                  {{len .Tasks}}
                </p>
              </div>
              <div class="p-3 bg-indigo-50 rounded-full">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 text-indigo-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                  />
                </svg>
              </div>
            </div>
          </div>

          <!-- Tasks Completed -->
          <div
            class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
          >
            <p class="text-sm font-medium text-gray-500">Tasks Selesai</p>
            <div class="mt-3 flex items-center gap-4">
              <p class="text-3xl font-bold text-gray-800">
                <span id="completedCount">0</span>/<span>{{len .Tasks}}</span>
              </p>
              <div class="flex-1">
                <div class="h-3 w-full rounded-full bg-gray-200">
                  <div
                    id="progressBar"
                    class="h-3 rounded-full bg-gradient-to-r from-indigo-500 to-indigo-600 transition-all duration-500"
                    style="width: 0%"
                  ></div>
                </div>
                <p class="text-xs text-gray-400 mt-1">
                  <span id="progressPercent">0</span>% completion
                </p>
              </div>
            </div>
          </div>

          <!-- Status Distribution -->
          <div
            class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
          >
            <p class="text-sm font-medium text-gray-500">Status Distribution</p>
            <div class="flex flex-wrap gap-2 mt-3" id="statusTags">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>

          <!-- System Info -->
          <div
            class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-500">System</p>
                <p class="mt-2 text-lg font-bold text-gray-800">{{.OS}}</p>
                <p class="text-xs text-gray-400">
                  {{len .Terminals}} terminals available
                </p>
              </div>
              <div class="p-3 bg-blue-50 rounded-full">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 text-blue-600"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Tasks Section -->
        <div>
          <div
            class="mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"
          >
            <h2 class="text-2xl font-bold text-gray-800">All Tasks</h2>
            <div class="flex items-center gap-4">
              <select
                id="filter-status"
                class="rounded-lg border-gray-300 shadow-sm bg-white px-3 py-2 text-sm"
              >
                <option value="all">Semua</option>
                <option value="done">Done</option>
                <option value="inprogress">In Progress</option>
                <option value="todo">Todo</option>
              </select>
            </div>
          </div>

          <!-- Tasks Grid -->
          <div
            class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"
            id="tasksContainer"
          >
            {{range .Tasks}}
            <div
              class="task-card status-{{.Status}} flex flex-col rounded-2xl bg-white shadow-lg overflow-hidden border-t-4 card-hover"
              data-status="{{.Status}}"
              data-task-id="{{.ID}}"
            >
              <div class="flex flex-col flex-grow p-6">
                <!-- Cover Image -->
                {{if .Cover}}
                <div class="mb-4">
                  <img
                    src="{{.Cover}}"
                    alt="Task cover"
                    class="w-full h-32 object-cover rounded-lg"
                  />
                </div>
                {{end}}

                <!-- Task Content -->
                <div class="flex-grow">
                  <div class="flex justify-between items-start mb-3">
                    <h3 class="text-lg font-bold text-gray-800 pr-2">
                      {{.Judul}}
                    </h3>
                    {{if eq .Status "done"}}
                    <span
                      class="inline-flex items-center rounded-full px-3 py-1 text-xs font-bold bg-green-100 text-green-700 border border-green-200"
                      >‚úÖ done</span
                    >
                    {{else if eq .Status "inprogress"}}
                    <span
                      class="inline-flex items-center rounded-full px-3 py-1 text-xs font-bold bg-orange-100 text-orange-700 border border-orange-200"
                      >üîÑ in progress</span
                    >
                    {{else}}
                    <span
                      class="inline-flex items-center rounded-full px-3 py-1 text-xs font-bold bg-gray-200 text-gray-600 border border-gray-300"
                      >‚è≥ todo</span
                    >
                    {{end}}
                  </div>

                  <p class="text-sm text-gray-600 mb-4">{{.Catatan}}</p>

                  <!-- Tags -->
                  {{if .Tags}}
                  <div class="flex flex-wrap gap-2 mb-4">
                    {{range split .Tags ","}} {{$tag := trim .}} {{if $tag}}
                    <span
                      class="rounded-full bg-indigo-50 px-3 py-1 text-xs font-medium text-indigo-600 border border-indigo-200"
                      >{{$tag}}</span
                    >
                    {{end}} {{end}}
                  </div>
                  {{end}}
                </div>

                <!-- Actions -->
                <div
                  class="border-t border-gray-100 pt-4 flex items-center justify-between"
                >
                  <div class="flex items-center gap-3 text-xs text-gray-500">
                    <span>{{.Tipe}}</span>
                    <span>‚Ä¢</span>
                    <span>{{.CreatedAt.Format "02 Jan 2006"}}</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <button
                      class="edit-task-btn inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 transition-all duration-200"
                      onclick="editTask({{.ID}}, '{{.Judul}}', '{{.Tipe}}', '{{.Status}}', '{{if .PathProject}}{{.PathProject}}{{end}}', '{{if .LinkWebsite}}{{.LinkWebsite}}{{end}}', '{{.Tags}}', '{{.Catatan}}')"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"
                        />
                      </svg>
                      Edit
                    </button>

                    {{if eq .Tipe "Website"}} {{if .LinkWebsite}}
                    <a
                      href="{{.LinkWebsite}}"
                      target="_blank"
                      class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 transition-all duration-200"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                        />
                      </svg>
                      Lihat Website
                    </a>
                    {{end}} {{else}} {{if .PathProject}}
                    <button
                      class="open-project-btn inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 transition-all duration-200"
                      onclick="openProject('{{.PathProject}}')"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"
                        />
                      </svg>
                      Open Terminal
                    </button>
                    {{end}} {{end}}
                  </div>
                </div>
              </div>
            </div>
            {{end}}
          </div>

          <!-- Empty State -->
          {{if not .Tasks}}
          <div class="text-center py-16">
            <div
              class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">
              Belum ada task
            </h3>
            <p class="text-gray-500 mb-6">
              Mulai tambahkan task untuk mengorganisir aktivitas coding dan
              belajar kamu
            </p>
            <button
              onclick="openAddTaskModal()"
              class="inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4v16m8-8H4"
                />
              </svg>
              Tambah Task Pertama
            </button>
          </div>
          {{else}}
          <div id="emptyState" class="hidden text-center py-16">
            <div
              class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">
              Tidak ada task yang sesuai filter
            </h3>
            <p class="text-gray-500 mb-6">
              Coba ubah filter status atau tambahkan task baru
            </p>
            <button
              onclick="openAddTaskModal()"
              class="inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4v16m8-8H4"
                />
              </svg>
              Tambah Task
            </button>
          </div>
          {{end}}
        </div>
      </div>
    </div>

    <!-- Add Task Modal -->
    <div
      id="addTaskModal"
      class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4"
    >
      <div
        class="relative w-full max-w-lg rounded-2xl glass-effect p-8 shadow-2xl"
      >
        <button
          id="closeAddTaskModal"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>

        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Tambah Task Baru</h2>
          <p class="text-gray-500 mt-1">
            Buat task baru untuk tracking progress kamu
          </p>
        </div>

        <form
          action="/task/add"
          method="POST"
          enctype="multipart/form-data"
          class="space-y-5"
        >
          <div>
            <label
              for="judul"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Judul Task</label
            >
            <input
              type="text"
              id="judul"
              name="judul"
              placeholder="Contoh: Belajar Next.js"
              required
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm transition-colors"
            />
          </div>

          <div>
            <label
              for="tipe"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Tipe</label
            >
            <select
              id="tipe"
              name="tipe"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            >
              <option value="Project Local">Project Local</option>
              <option value="Website">Website</option>
            </select>
          </div>

          <div id="path-project-group">
            <label
              for="path-project"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Path Project</label
            >
            <input
              type="text"
              id="path-project"
              name="path_project"
              placeholder="/home/user/Documents/project"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            />
          </div>

          <div id="url-website-group" class="hidden">
            <label
              for="link-website"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >URL Website</label
            >
            <input
              type="url"
              id="link-website"
              name="link_website"
              placeholder="https://example.com"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            />
          </div>

          <div>
            <label
              for="tags"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Tags (pisahkan dengan koma)</label
            >
            <input
              type="text"
              id="tags"
              name="tags"
              placeholder="react, frontend, belajar"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            />
          </div>

          <div>
            <label
              for="catatan"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Catatan</label
            >
            <textarea
              id="catatan"
              name="catatan"
              rows="3"
              placeholder="Deskripsi atau catatan task..."
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm resize-none"
            ></textarea>
          </div>

          <div>
            <label
              for="cover"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Cover Image (Opsional)</label
            >
            <input
              type="file"
              id="cover"
              name="cover"
              accept="image/png, image/jpeg"
              class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 file:transition-colors"
            />
          </div>

          <div class="pt-4">
            <button
              type="submit"
              class="w-full flex justify-center items-center gap-2 rounded-xl bg-gradient-to-r from-indigo-500 to-indigo-600 py-3 px-4 text-sm font-semibold text-white shadow-lg hover:from-indigo-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4v16m8-8H4"
                />
              </svg>
              Tambah Task
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Task Modal -->
    <div
      id="editTaskModal"
      class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4"
    >
      <div
        class="relative w-full max-w-lg rounded-2xl glass-effect p-8 shadow-2xl"
      >
        <button
          id="closeEditTaskModal"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>

        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Edit Task</h2>
          <p class="text-gray-500 mt-1">Perbarui detail task kamu.</p>
        </div>

        <form
          id="editTaskForm"
          method="POST"
          enctype="multipart/form-data"
          class="space-y-5"
        >
          <input type="hidden" id="edit-task-id" name="id" />
          <div>
            <label
              for="edit-judul"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Judul Task</label
            >
            <input
              type="text"
              id="edit-judul"
              name="judul"
              required
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm transition-colors"
            />
          </div>

          <div>
            <label
              for="edit-tipe"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Tipe</label
            >
            <select
              id="edit-tipe"
              name="tipe"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            >
              <option value="Project Local">Project Local</option>
              <option value="Website">Website</option>
            </select>
          </div>

          <div>
            <label
              for="edit-status"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Status</label
            >
            <select
              id="edit-status"
              name="status"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            >
              <option value="todo">Todo</option>
              <option value="inprogress">In Progress</option>
              <option value="done">Done</option>
            </select>
          </div>

          <div id="edit-path-project-group">
            <label
              for="edit-path-project"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Path Project</label
            >
            <input
              type="text"
              id="edit-path-project"
              name="path_project"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            />
          </div>

          <div id="edit-url-website-group" class="hidden">
            <label
              for="edit-link-website"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >URL Website</label
            >
            <input
              type="url"
              id="edit-link-website"
              name="link_website"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            />
          </div>

          <div>
            <label
              for="edit-tags"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Tags (pisahkan dengan koma)</label
            >
            <input
              type="text"
              id="edit-tags"
              name="tags"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm"
            />
          </div>

          <div>
            <label
              for="edit-catatan"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Catatan</label
            >
            <textarea
              id="edit-catatan"
              name="catatan"
              rows="3"
              class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm resize-none"
            ></textarea>
          </div>

          <div>
            <label
              for="edit-cover"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Cover Image (Opsional)</label
            >
            <input
              type="file"
              id="edit-cover"
              name="cover"
              accept="image/png, image/jpeg"
              class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 file:transition-colors"
            />
          </div>

          <div class="pt-4">
            <button
              type="submit"
              class="w-full flex justify-center items-center gap-2 rounded-xl bg-gradient-to-r from-indigo-500 to-indigo-600 py-3 px-4 text-sm font-semibold text-white shadow-lg hover:from-indigo-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                />
              </svg>
              Simpan Perubahan
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Terminal Modal -->
    <div
      id="terminalModal"
      class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4"
    >
      <div
        class="relative w-full max-w-sm rounded-2xl glass-effect p-8 text-center shadow-2xl"
      >
        <button
          id="closeTerminalModal"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>

        <div class="mb-6">
          <div
            class="mx-auto w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mb-4"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-indigo-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"
              />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Buka Proyek</h3>
          <p class="text-sm text-gray-500 mt-2">
            Pilih terminal untuk membuka proyek.
          </p>
        </div>

        <div class="space-y-3">
          <select
            id="terminal-select"
            class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 text-sm mb-3"
          >
            <option value="">Pilih terminal...</option>
            {{range .Terminals}}
            <option value="{{.Command}}">{{.Name}}</option>
            {{end}}
          </select>

          <button
            id="openInTerminal"
            class="w-full flex items-center justify-center gap-3 rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 py-3 text-sm font-semibold text-white shadow-lg hover:from-gray-900 hover:to-black focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"
              />
            </svg>
            Buka di Terminal
          </button>
        </div>
      </div>
    </div>

    <script>
      let currentProjectPath = "";

      // Calculate and update stats
      function updateStats() {
        const tasks = document.querySelectorAll(".task-card");
        const totalTasks = tasks.length;

        let completedCount = 0;
        let todoCount = 0;
        let inprogressCount = 0;
        let doneCount = 0;

        tasks.forEach((task) => {
          const status = task.dataset.status;
          if (status === "done") {
            completedCount++;
            doneCount++;
          } else if (status === "inprogress") {
            inprogressCount++;
          } else if (status === "todo") {
            todoCount++;
          }
        });

        const percentage =
          totalTasks > 0 ? Math.round((completedCount / totalTasks) * 100) : 0;

        // Update DOM
        document.getElementById("completedCount").textContent = completedCount;
        document.getElementById("progressBar").style.width = percentage + "%";
        document.getElementById("progressPercent").textContent = percentage;

        // Update status tags
        const statusTags = document.getElementById("statusTags");
        statusTags.innerHTML = `
          <span class="rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-700">Todo (${todoCount})</span>
          <span class="rounded-full bg-orange-100 px-3 py-1 text-xs font-medium text-orange-700">Progress (${inprogressCount})</span>
          <span class="rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-700">Done (${doneCount})</span>
        `;
      }

      // Modal functions
      function openAddTaskModal() {
        document.getElementById("addTaskModal").classList.remove("hidden");
        document.getElementById("addTaskModal").classList.add("flex");
        document.body.style.overflow = "hidden";
      }

      function closeAddTaskModal() {
        document.getElementById("addTaskModal").classList.add("hidden");
        document.getElementById("addTaskModal").classList.remove("flex");
        document.body.style.overflow = "auto";
      }

      function editTask(
        id,
        judul,
        tipe,
        status,
        pathProject,
        linkWebsite,
        tags,
        catatan,
      ) {
        document.getElementById("edit-task-id").value = id;
        document.getElementById("edit-judul").value = judul;
        document.getElementById("edit-tipe").value = tipe;
        document.getElementById("edit-status").value = status;
        document.getElementById("edit-path-project").value = pathProject || "";
        document.getElementById("edit-link-website").value = linkWebsite || "";
        document.getElementById("edit-tags").value = tags || "";
        document.getElementById("edit-catatan").value = catatan || "";

        // Update form action
        document.getElementById("editTaskForm").action = `/task/update/${id}`;

        // Toggle fields
        toggleEditFields();

        document.getElementById("editTaskModal").classList.remove("hidden");
        document.getElementById("editTaskModal").classList.add("flex");
        document.body.style.overflow = "hidden";
      }

      function closeEditTaskModal() {
        document.getElementById("editTaskModal").classList.add("hidden");
        document.getElementById("editTaskModal").classList.remove("flex");
        document.body.style.overflow = "auto";
      }

      function openProject(path) {
        currentProjectPath = path;
        document.getElementById("terminalModal").classList.remove("hidden");
        document.getElementById("terminalModal").classList.add("flex");
        document.body.style.overflow = "hidden";
      }

      function closeTerminalModal() {
        document.getElementById("terminalModal").classList.add("hidden");
        document.getElementById("terminalModal").classList.remove("flex");
        document.body.style.overflow = "auto";
      }

      // Toggle form fields
      function toggleFields() {
        const tipeSelect = document.getElementById("tipe");
        const pathGroup = document.getElementById("path-project-group");
        const urlGroup = document.getElementById("url-website-group");

        if (tipeSelect.value === "Project Local") {
          pathGroup.classList.remove("hidden");
          urlGroup.classList.add("hidden");
        } else {
          pathGroup.classList.add("hidden");
          urlGroup.classList.remove("hidden");
        }
      }

      function toggleEditFields() {
        const tipeSelect = document.getElementById("edit-tipe");
        const pathGroup = document.getElementById("edit-path-project-group");
        const urlGroup = document.getElementById("edit-url-website-group");

        if (tipeSelect.value === "Project Local") {
          pathGroup.classList.remove("hidden");
          urlGroup.classList.add("hidden");
        } else {
          pathGroup.classList.add("hidden");
          urlGroup.classList.remove("hidden");
        }
      }

      // Filter tasks
      function filterTasks() {
        const filterStatus = document.getElementById("filter-status").value;
        const taskCards = document.querySelectorAll(".task-card");
        let visibleCount = 0;

        taskCards.forEach((card) => {
          const status = card.dataset.status;
          const shouldShow = filterStatus === "all" || status === filterStatus;

          if (shouldShow) {
            card.style.display = "flex";
            visibleCount++;
          } else {
            card.style.display = "none";
          }
        });

        const emptyState = document.getElementById("emptyState");
        if (emptyState) {
          if (visibleCount === 0) {
            emptyState.classList.remove("hidden");
          } else {
            emptyState.classList.add("hidden");
          }
        }
      }

      // Event listeners
      document.addEventListener("DOMContentLoaded", function () {
        updateStats();

        // Modal event listeners
        document
          .getElementById("addTaskBtn")
          .addEventListener("click", openAddTaskModal);
        document
          .getElementById("closeAddTaskModal")
          .addEventListener("click", closeAddTaskModal);
        document
          .getElementById("closeEditTaskModal")
          .addEventListener("click", closeEditTaskModal);
        document
          .getElementById("closeTerminalModal")
          .addEventListener("click", closeTerminalModal);

        // Form field toggles
        document
          .getElementById("tipe")
          .addEventListener("change", toggleFields);
        document
          .getElementById("edit-tipe")
          .addEventListener("change", toggleEditFields);
        toggleFields();

        // Filter
        document
          .getElementById("filter-status")
          .addEventListener("change", filterTasks);

        // Terminal integration
        document
          .getElementById("openInTerminal")
          .addEventListener("click", function () {
            const selectedTerminal =
              document.getElementById("terminal-select").value;
            if (!selectedTerminal) {
              alert("Silakan pilih terminal terlebih dahulu.");
              return;
            }
            if (currentProjectPath) {
              try {
                const ws = new WebSocket("ws://localhost:8080/ws");
                ws.onopen = function () {
                  ws.send(
                    JSON.stringify({
                      terminal: selectedTerminal,
                      path: currentProjectPath,
                    }),
                  );
                  closeTerminalModal();
                  alert("Terminal berhasil dibuka!");
                  ws.close();
                };
                ws.onerror = function () {
                  alert("Gagal membuka terminal");
                };
              } catch (error) {
                console.error("Error spawning terminal:", error);
                alert("Gagal membuka terminal");
              }
            }
          });

        // Close modals on outside click
        window.addEventListener("click", function (event) {
          const addModal = document.getElementById("addTaskModal");
          const editModal = document.getElementById("editTaskModal");
          const terminalModal = document.getElementById("terminalModal");

          if (event.target === addModal) closeAddTaskModal();
          if (event.target === editModal) closeEditTaskModal();
          if (event.target === terminalModal) closeTerminalModal();
        });

        // Keyboard shortcuts
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            const addModal = document.getElementById("addTaskModal");
            const editModal = document.getElementById("editTaskModal");
            const terminalModal = document.getElementById("terminalModal");

            if (!addModal.classList.contains("hidden")) closeAddTaskModal();
            if (!editModal.classList.contains("hidden")) closeEditTaskModal();
            if (!terminalModal.classList.contains("hidden"))
              closeTerminalModal();
          }
        });
      });
    </script>
  </body>
</html>
